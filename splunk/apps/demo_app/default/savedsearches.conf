# Pre-built saved searches for demo scenarios

# ============================================================================
# DevOps Saved Searches
# ============================================================================

[DevOps - Failed Pipelines Today]
search = index=demo_devops sourcetype=cicd:pipeline status=failure earliest=-24h | stats count by repository, workflow | sort -count
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
description = Shows failed CI/CD pipelines in the last 24 hours

[DevOps - Deployment Frequency]
search = index=demo_devops sourcetype=deploy:events | timechart span=1h count by environment
dispatch.earliest_time = -7d@d
dispatch.latest_time = now
description = Deployment frequency by environment over the past week

[DevOps - Container Restarts]
search = index=demo_devops sourcetype=container:docker restart_count>0 | stats sum(restart_count) as restarts by container_name | sort -restarts
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
description = Containers with high restart counts

# ============================================================================
# SRE Saved Searches
# ============================================================================

[SRE - Top Errors by Service]
search = index=demo_sre sourcetype=app:errors | stats count by service, error_type | sort -count | head 20
dispatch.earliest_time = -1h@m
dispatch.latest_time = now
description = Top errors across all services in the last hour

[SRE - P99 Latency by Endpoint]
search = index=demo_sre sourcetype=metrics:latency | stats perc99(duration_ms) as p99_latency by endpoint | where p99_latency>500 | sort -p99_latency
dispatch.earliest_time = -1h@m
dispatch.latest_time = now
description = Endpoints with P99 latency above 500ms

[SRE - Service Health Status]
search = index=demo_sre sourcetype=health:checks | stats latest(status) as status, latest(response_time_ms) as response_time by service | eval health=if(status="healthy", "OK", "DEGRADED")
dispatch.earliest_time = -15m
dispatch.latest_time = now
description = Current health status of all services

[SRE - Error Rate Trend]
search = index=demo_sre sourcetype=app:errors | timechart span=5m count as errors | streamstats avg(errors) as avg_errors window=12 | eval anomaly=if(errors>avg_errors*2, 1, 0)
dispatch.earliest_time = -1h@m
dispatch.latest_time = now
description = Error rate with anomaly detection

# ============================================================================
# Support Saved Searches
# ============================================================================

[Support - Customer Session Lookup]
search = index=demo_support sourcetype=session:trace | stats values(page) as pages, sum(duration_ms) as total_duration, count as actions by session_id, user_id | sort -_time
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
description = Customer session activity summary

[Support - User-Facing Errors]
search = index=demo_support sourcetype=error:user | stats count by error_code, page, customer_tier | sort -count
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
description = Errors seen by customers grouped by page

[Support - Feature Usage by Tier]
search = index=demo_support sourcetype=feature:usage | stats count by feature, customer_tier | xyseries feature customer_tier count
dispatch.earliest_time = -7d@d
dispatch.latest_time = now
description = Feature usage breakdown by customer tier

# ============================================================================
# Management Saved Searches
# ============================================================================

[Management - Daily Revenue Trend]
search = index=demo_business sourcetype=kpi:revenue | timechart span=1d sum(value) as daily_revenue by region
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
description = Daily revenue trend by region

[Management - Compliance Audit Trail]
search = index=demo_business sourcetype=compliance:audit action=* | stats count by user, action, resource | sort -_time
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
description = Admin actions audit trail

[Management - Capacity Utilization]
search = index=demo_business sourcetype=capacity:metrics | stats avg(cpu_percent) as avg_cpu, avg(memory_percent) as avg_memory by host | eval status=if(avg_cpu>80 OR avg_memory>80, "High", "Normal")
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
description = Resource utilization by host

# ============================================================================
# Alerts
# ============================================================================

[Alert - High Error Rate]
search = index=demo_sre sourcetype=app:errors | stats count as error_count by service | where error_count > 100
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.track = 1
alert.severity = 4
cron_schedule = */5 * * * *
enableSched = 1
action.webhook = 1
action.webhook.param.url = http://webhook-catcher:8080/alerts
description = Alert when error count exceeds 100 in 5 minutes

[Alert - Failed Deployment]
search = index=demo_devops sourcetype=cicd:pipeline status=failure environment=production | stats count
dispatch.earliest_time = -5m
dispatch.latest_time = now
alert.track = 1
alert.severity = 5
cron_schedule = */5 * * * *
enableSched = 1
action.webhook = 1
action.webhook.param.url = http://webhook-catcher:8080/alerts
description = Alert when production deployment fails
